<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Organizer - Tasks</title>


    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
       
        .fade-in {
            animation: fadeIn 0.7s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ⭐ ANIMACIÓN 2: Botón "pulse" al pasar */
        .pulse:hover {
            animation: pulse 0.3s ease-in-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* ⭐ ANIMACIÓN 3: Fade-out al eliminar */
        .fade-out {
            animation: fadeOut 0.4s forwards;
        }
        @keyframes fadeOut {
            to { opacity: 0; transform: translateX(-20px); }
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen">

    <!-- Header -->
    <header class="bg-blue-700 p-4 text-white text-center shadow-md">
        <h1 class="text-3xl font-bold">Study Organizer - Tasks</h1>
    </header>

    <main class="max-w-3xl mx-auto mt-10 bg-white p-6 rounded-lg shadow fade-in">
         <!-- Dashboard Chart -->
    <section class="mb-10">
        <h2 class="text-xl font-semibold mb-3">Task Overview (Dashboard)</h2>
        <div class="bg-white p-4 rounded shadow">
            <canvas id="taskChart" height="120"></canvas>
        </div>
    </section>
        <!-- Stats Section -->
        <div class="mb-6 p-4 bg-blue-100 rounded-lg flex justify-between">
            <p><strong>Total tasks:</strong> <span id="statTotal">0</span></p>
            <p><strong>Completed:</strong> <span id="statCompleted">0</span></p>
            <p><strong>Pending:</strong> <span id="statPending">0</span></p>
        </div>

        <!-- Filters -->
        <div class="flex gap-3 mb-6">
            <button onclick="setFilter('all')" 
                class="px-4 py-2 bg-gray-300 rounded pulse">All</button>
            <button onclick="setFilter('pending')" 
                class="px-4 py-2 bg-yellow-400 rounded pulse">Pending</button>
            <button onclick="setFilter('completed')" 
                class="px-4 py-2 bg-green-500 text-white rounded pulse">Completed</button>
        </div>

        <!-- New Task Form -->
        <h2 class="text-xl font-semibold mb-3">Add New Task</h2>

        <form id="taskForm" class="mb-6">
            <input type="text" id="title" class="border p-2 w-full mb-2" placeholder="Title" required>
            <input type="text" id="description" class="border p-2 w-full mb-2" placeholder="Description">
            <input type="date" id="dueDate" class="border p-2 w-full mb-2">

            <button type="submit"
                class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 w-full pulse">
                Add Task
            </button>
        </form>

        <!-- Task List -->
        <h2 class="text-xl font-semibold mb-3">Tasks</h2>
        <div id="taskList" class="space-y-3"></div>

    </main>

    <!-- Edit Modal -->
    <div id="editModal"
         class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center">
        <div class="bg-white p-6 rounded w-96 shadow-lg fade-in">
            <h2 class="text-xl font-semibold mb-3">Edit Task</h2>

            <input id="editTitle" class="border p-2 w-full mb-2" placeholder="Title">
            <input id="editDescription" class="border p-2 w-full mb-2" placeholder="Description">
            <input id="editDueDate" type="date" class="border p-2 w-full mb-2">

            <div class="flex justify-end gap-2">
                <button onclick="closeEditForm()"
                        class="px-3 py-1 bg-gray-400 text-white rounded pulse">Cancel</button>
                <button onclick="updateTask()"
                        class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 pulse">Save</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        const API_URL = "http://localhost:8080/tasks";
        let editingId = null;
        let currentFilter = "all";

        document.addEventListener("DOMContentLoaded", loadTasks);

        // Add Task
        document.getElementById("taskForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const newTask = {
                title: document.getElementById("title").value,
                description: document.getElementById("description").value,
                dueDate: document.getElementById("dueDate").value,
                completed: false
            };

            await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(newTask)
            });

            document.getElementById("taskForm").reset();
            loadTasks();
        });

        // Load tasks with filter + stats
        async function loadTasks() {
            const res = await fetch(API_URL);
            const tasks = await res.json();

            updateStats(tasks);

            let filtered = tasks;
            if (currentFilter === "completed") filtered = tasks.filter(t => t.completed);
            if (currentFilter === "pending") filtered = tasks.filter(t => !t.completed);

            const taskList = document.getElementById("taskList");
            taskList.innerHTML = "";

            filtered.forEach(task => {
                const item = document.createElement("div");
                item.className = "p-4 bg-gray-200 rounded flex justify-between items-center shadow fade-in";

                item.innerHTML = `
                    <div>
                        <h3 class="font-bold text-lg ${task.completed ? 'line-through text-green-600' : ''}">
                            ${task.title}
                        </h3>
                        <p>${task.description || ""}</p>
                        <p class="text-sm text-gray-600">Due: ${task.dueDate || "N/A"}</p>
                    </div>

                    <div class="flex gap-2">
                        <button onclick="toggleComplete(${task.id}, ${task.completed})"
                            class="px-3 py-1 rounded ${task.completed ? 'bg-green-600 text-white' : 'bg-gray-500 text-white'} pulse">
                            ${task.completed ? "✔ Done" : "Mark Done"}
                        </button>

                        <button onclick="showEditForm(${task.id}, '${task.title}', '${task.description}', '${task.dueDate}')"
                            class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 pulse">
                            Edit
                        </button>

                        <button onclick="deleteTask(${task.id}, this)"
                            class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-700 pulse">
                            Delete
                        </button>
                    </div>
                `;

                taskList.appendChild(item);
            });
        }

        function setFilter(filter) {
            currentFilter = filter;
            loadTasks();
        }

    
let chart = null;

function updateChart(total, completed, pending) {
    const ctx = document.getElementById("taskChart").getContext("2d");

    if (chart) chart.destroy();

    chart = new Chart(ctx, {
        type: "doughnut",
        data: {
            labels: ["Completed", "Pending"],
            datasets: [{
                data: [completed, pending],
                backgroundColor: ["#16a34a", "#facc15"],
                hoverOffset: 10
            }]
        }
    });
}

        async function deleteTask(id, element) {
            const card = element.parentElement.parentElement;
            card.classList.add("fade-out");

            setTimeout(async () => {
                await fetch(`${API_URL}/${id}`, { method: "DELETE" });
                loadTasks();
            }, 400);
        }

        async function toggleComplete(id, current) {
            await fetch(`${API_URL}/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ completed: !current })
            });
            loadTasks();
        }

        function showEditForm(id, title, description, dueDate) {
            editingId = id;
            document.getElementById("editTitle").value = title;
            document.getElementById("editDescription").value = description;
            document.getElementById("editDueDate").value = dueDate;
            document.getElementById("editModal").classList.remove("hidden");
        }

        function closeEditForm() {
            document.getElementById("editModal").classList.add("hidden");
        }

   function updateStats(tasks) {
    const total = tasks.length;
    const completed = tasks.filter(t => t.completed).length;
    const pending = total - completed;

    document.getElementById("statTotal").innerText = total;
    document.getElementById("statCompleted").innerText = completed;
    document.getElementById("statPending").innerText = pending;

    updateChart(total, completed, pending);
}

            closeEditForm();
            loadTasks();
async function updateTask() {
    const updatedTask = {
        title: document.getElementById("editTitle").value,
        description: document.getElementById("editDescription").value,
        dueDate: document.getElementById("editDueDate").value,
        completed: false
    };

    await fetch(`${API_URL}/${editingId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updatedTask)
    });

    closeEditForm();
    loadTasks();
}

    </script>

</body>
</html>
